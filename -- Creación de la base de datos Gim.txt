-- Creaci√≥n de la base de datos Gimnasio
USE master;
GO
DROP DATABASE IF EXISTS Gimnasio2;
GO
CREATE DATABASE Gimnasio2;
GO
USE Gimnasio2;
GO

-- Tabla TiposMembresias
CREATE TABLE TiposMembresias (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    Descripcion VARCHAR(100),
    Precio MONEY
);
GO

-- Tabla Personas
CREATE TABLE Personas (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    DNI VARCHAR(10) UNIQUE,
    Nombre VARCHAR(50),
    Apellido VARCHAR(50),
    Email VARCHAR(70) UNIQUE,
    FechaNacimiento DATE
);
GO

INSERT INTO Personas (DNI, Nombre, Apellido, Email, FechaNacimiento)
VALUES ('12345678', 'Admin', 'Admin', 'admin@example.com', '1990-01-01');

-- Tabla CargosEmpleados
CREATE TABLE CargosEmpleados (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    Descripcion VARCHAR(100) UNIQUE
);
GO

-- Tabla Empleados
CREATE TABLE Empleados (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    IDPersona INT FOREIGN KEY REFERENCES Personas(ID),
    IDCargoEmpleado INT FOREIGN KEY REFERENCES CargosEmpleados(ID)
);
GO		

-- Tabla Miembros
CREATE TABLE Miembros (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    IDPersona INT FOREIGN KEY REFERENCES Personas(ID),
    IDTipoMembresia INT FOREIGN KEY REFERENCES TiposMembresias(ID),
    FechaInicio DATE DEFAULT GETDATE(), -- Valor predeterminado configurado a la fecha actual
    FechaFin DATE default DATEADD(DAY, 30,GETDATE()),
    EstadoActivo BIT
);
GO

-- Tabla Roles
CREATE TABLE Roles (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    Nombre VARCHAR(50) UNIQUE
);
GO

-- Tabla Usuarios
CREATE TABLE Usuarios (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    IDPersona INT FOREIGN KEY REFERENCES Personas(ID),
    IDRol INT FOREIGN KEY REFERENCES Roles(ID),
    NombreUsuario VARCHAR(50) UNIQUE,
    Clave VARCHAR(50)
);
GO

-- Tabla Cobros
CREATE TABLE Cobros (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    IDPersonas INT FOREIGN KEY REFERENCES Personas(ID),
	IDEmpleado INT FOREIGN KEY REFERENCES Empleados(ID),
    IDTipoMembresia INT FOREIGN KEY REFERENCES TiposMembresias(ID),
    FechaCobro DATE

);
GO

CREATE TABLE Imagenes (
    ID INT PRIMARY KEY identity(1,1),
    IDPersona INT foreign key references Personas(ID),
    Archivo VARBINARY(MAX)
);
go
create table ClasesSalon(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    Descripcion VARCHAR(100) unique
	);

	create table Salones(
    ID INT IDENTITY(1,1) PRIMARY KEY,
    Nombre VARCHAR(100) unique,
	Capacidad int not null,
	);

CREATE TABLE HorariosClases (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    IDClaseSalon INT FOREIGN KEY REFERENCES ClasesSalon(ID),
    IDSalon INT FOREIGN KEY REFERENCES Salones(ID),
    Fecha DATE,
    HoraInicio TIME,
    HoraFin TIME,
    IDInstructor INT FOREIGN KEY REFERENCES Empleados(ID) -- Nueva columna para el instructor
);

	create table Reservas(
	ID INT IDENTITY(1,1) PRIMARY KEY,
	IDClaseSalon INT FOREIGN KEY REFERENCES ClasesSalon(ID),
	IDSalone INT FOREIGN KEY REFERENCES Salones(ID),
	IDMiembro INT FOREIGN KEY REFERENCES Miembros(ID),
	IDHorarioClase INT FOREIGN KEY REFERENCES HorariosClases(ID),
	)
	
ALTER TABLE HorariosClases
ALTER COLUMN HoraInicio VARCHAR(8);

ALTER TABLE HorariosClases
ALTER COLUMN HoraFin VARCHAR(8);

UPDATE HorariosClases
SET HoraInicio = LEFT(CONVERT(VARCHAR, HoraInicio, 108), 5),
    HoraFin = LEFT(CONVERT(VARCHAR, HoraFin, 108), 5);

INSERT INTO TiposMembresias (Descripcion, Precio)
VALUES
('Musculacion', 25000.00),
('Clases de Salon',20000.00),
('Pase Dorado',35000.00);
GO

INSERT INTO Roles (Nombre)
VALUES
('Administrador'),
('Empleado Recepcion'),
('Cliente'),
('Instructor Salon'),
('Instructor Musculacion');

GO

SELECT * FROM roles;
SELECT * FROM Personas ;
select * from Empleados;
SELECT * FROM Usuarios;
select * from HorariosClases;

--update Miembros set FechaInicio= '2024-03-30' , FechaFin='2024-04-30' where IDPersona= 9;
--INSERT INTO Miembros (IDPersona, IDTipoMembresia) OUTPUT INSERTED.ID VALUES (1, 1)


insert into Usuarios(IDPersona,IDRol,NombreUsuario,Clave ) values (1,1,'Admin','Admin');


